<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>現在日時表示</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS custom configuration
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // 'inter' is kept as a fallback or if explicitly used in Tailwind classes
                        inter: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: transparent; /* For transparent background in OBS */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* Hide scrollbars */
            /* font-family will be set by JS based on parameter or default to Inter */
        }
        /* Main container shadow and rounded corners */
        #main-container {
            border-radius: 1rem; /* rounded-2xl */
            padding: 0.75rem; /* Reduced overall padding */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-lg */
            display: flex;
            flex-direction: column;
            width: fit-content; /* Reverted to fit-content */
            position: relative; /* For any future absolute positioning */
            /* background-color will be set by JS */
        }

        /* Wrapper for date display to handle alignment */
        #date-display-wrapper,
        #time-display-wrapper {
            width: 100%; /* Occupy full width of parent for alignment */
            display: flex; /* Use flexbox for reliable alignment */
            /* justify-content will be set by JS */
        }

        /* Date display area */
        #date-display {
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.3rem 0.7rem; /* Adjusted padding for better balance */
            margin-bottom: 0.2rem; /* Adjusted spacing */
            font-size: 0.85em; /* Adjusted font size for better balance */
            font-weight: bold; /* font-bold */
            white-space: nowrap; /* Prevent text wrapping */
            /* background-color and color will be set by JS */
            width: fit-content; /* Keep fit-content for background to be near text */
            line-height: 1.2; /* Adjust line height for better vertical alignment */
        }
        /* Time display area */
        #time-display {
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.5rem 1rem; /* Adjusted padding for better balance */
            font-size: 3.5em; /* Adjusted to design */
            font-weight: bold; /* font-bold */
            white-space: nowrap; /* Prevent text wrapping */
            /* background-color and color will be set by JS */
            width: fit-content; /* Keep fit-content for background to be near text */
            line-height: 1.2; /* Adjust line height for better vertical alignment */
            position: relative; /* Needed for absolute positioning of ::after */
            overflow: hidden; /* Ensures the progress bar stays within bounds */
        }

        /* Minute progress bar styles */
        #time-display::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px; /* Thickness of the progress bar */
            width: var(--progress-width, 0%); /* Controlled by JS, defaults to 0% */
            background-color: var(--progress-bar-color); /* Set by JS */
            border-bottom-left-radius: 0.5rem; /* Match parent border-radius */
            border-bottom-right-radius: 0.5rem; /* Match parent border-radius */
            transition: width 0.1s linear; /* Smooth animation for width change */
        }
    </style>
</head>
<body>
    <div id="main-container">
        <div id="date-display-wrapper">
            <div id="date-display"></div>
        </div>
        <div id="time-display-wrapper">
            <div id="time-display"></div>
        </div>
    </div>

    <script>
        // グローバルスコープで要素を宣言
        let timeDisplay;
        let urlParams; // URLパラメータをグローバルで保持

        /**
         * Parses URL parameters and returns them as an object.
         * @returns {Object} An object containing URL parameters.
         */
        function getUrlParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const [key, value] = param.split('=');
                if (key && value) {
                    params[key] = decodeURIComponent(value);
                }
            });
            // showProgressBar パラメータの処理
            // 'true' 文字列の場合は true、それ以外は false として扱う。デフォルトは false。
            params.showProgressBar = params.showProgressBar === 'true' ? true : false;
            return params;
        }

        /**
         * Converts a hex color string (e.g., "RRGGBB") to a CSS color string (e.g., "#RRGGBB").
         * If the input is not a 6-digit hex, it returns the input as is (assuming it's a CSS color name).
         * @param {string} color - The color string.
         * @returns {string} The formatted CSS color string.
         */
        function formatColor(color) {
            if (color && color.match(/^[0-9A-Fa-f]{6}$/)) {
                return `#${color}`;
            }
            return color;
        }

        /**
         * Converts a hex color to an RGBA string.
         * @param {string} hex - The hex color string (e.g., "#RRGGBB" or "RRGGBB").
         * @param {number} alpha - The alpha transparency value (0-1).
         * @returns {string} The RGBA color string.
         */
        function hexToRgba(hex, alpha) {
            let r = 0, g = 0, b = 0;
            // Handle hex without '#'
            if (hex.startsWith('#')) {
                hex = hex.slice(1);
            }
            if (hex.length === 6) {
                r = parseInt(hex.substring(0, 2), 16);
                g = parseInt(hex.substring(2, 4), 16);
                b = parseInt(hex.substring(4, 6), 16);
            }
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        /**
         * Updates the current date and time display and the minute indicator.
         */
        function updateDateTime() {
            const now = new Date();

            // Date format (e.g., 6/3 (Tue))
            const dateOptions = {
                month: 'numeric',
                day: 'numeric',
                weekday: 'short' // Display abbreviated weekday
            };
            const dateFormatter = new Intl.DateTimeFormat(navigator.language, dateOptions);
            const formattedDate = dateFormatter.format(now);

            // Get timezone abbreviation
            const timeZoneOptions = {
                timeZoneName: 'short'
            };
            const timeZoneFormatter = new Intl.DateTimeFormat(navigator.language, timeZoneOptions);
            const timeZoneParts = timeZoneFormatter.formatToParts(now);
            let timeZoneAbbr = '';
            for (const part of timeZoneParts) {
                if (part.type === 'timeZoneName') {
                    timeZoneAbbr = part.value;
                    break;
                }
            }

            // Time format (例: 13:24)
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                hourCycle: 'h23' // 24-hour display
            };
            const timeFormatter = new Intl.DateTimeFormat(navigator.language, timeOptions);
            const formattedTime = timeFormatter.format(now);

            // Get seconds for minute progress animation
            const seconds = now.getSeconds();

            // timeDisplayがnullでないことを確認
            if (!timeDisplay) {
                return; // 要素がまだ利用できない場合は処理を中断
            }

            // プログレスバーの表示設定に基づいて幅を計算
            let progressPercentage = 0;
            if (urlParams.showProgressBar) {
                progressPercentage = (seconds / 60) * 100;
            }

            // Set the CSS variable for the width of the ::after pseudo-element
            document.documentElement.style.setProperty('--progress-width', `${progressPercentage}%`);


            // Combine and display date and timezone
            document.getElementById('date-display').textContent = `${formattedDate} (${timeZoneAbbr})`;
            document.getElementById('time-display').textContent = formattedTime;
        }

        // Event listener for DOM content loaded
        document.addEventListener('DOMContentLoaded', () => {
            urlParams = getUrlParams(); // URLパラメータを初期化

            const body = document.body;
            const mainContainer = document.getElementById('main-container');
            const dateDisplay = document.getElementById('date-display');
            const dateDisplayWrapper = document.getElementById('date-display-wrapper');
            const timeDisplayWrapper = document.getElementById('time-display-wrapper');

            // DOMContentLoaded内で要素への参照を取得
            timeDisplay = document.getElementById('time-display');


            // Apply background color to body
            body.style.backgroundColor = formatColor(urlParams.bgColor || 'transparent');

            // Apply background color to main container
            mainContainer.style.backgroundColor = formatColor(urlParams.containerBgColor || '#FFFFFF');

            // Apply colors to date display
            dateDisplay.style.backgroundColor = formatColor(urlParams.dateBgColor || '#E2BEE6');
            dateDisplay.style.color = formatColor(urlParams.dateTextColor || '#6D2A84');

            // Apply colors to time display
            timeDisplay.style.backgroundColor = formatColor(urlParams.timeBgColor || '#CD93D7');
            timeDisplay.style.color = formatColor(urlParams.timeTextColor || '#48148A');

            // Set progress bar color based on timeTextColor with some transparency
            const progressBarBaseColor = formatColor(urlParams.timeTextColor || '#48148A');
            document.documentElement.style.setProperty('--progress-bar-color', hexToRgba(progressBarBaseColor, 0.8));


            // Determine justify-content value based on dateAlign parameter
            const dateAlignment = urlParams.dateAlign || 'left'; // Default to 'left'
            let dateJustifyValue;
            switch (dateAlignment) {
                case 'left':
                    dateJustifyValue = 'flex-start';
                    break;
                case 'right':
                    dateJustifyValue = 'flex-end';
                    break;
                case 'center':
                default:
                    dateJustifyValue = 'center';
                    break;
            }
            dateDisplayWrapper.style.justifyContent = dateJustifyValue;

            // Default time alignment to center as timeAlign parameter is removed
            timeDisplayWrapper.style.justifyContent = 'center';

            // Apply font sizes if provided
            if (urlParams.dateFontSize) {
                dateDisplay.style.fontSize = urlParams.dateFontSize;
            }
            if (urlParams.timeFontSize) {
                timeDisplay.style.fontSize = urlParams.timeFontSize;
            }

            // Apply overall scale if provided
            if (urlParams.scale) {
                mainContainer.style.transform = `scale(${urlParams.scale})`;
                mainContainer.style.transformOrigin = 'center center'; // Scale from the center
            }

            // Apply font family if provided, otherwise default to 'Inter'
            body.style.fontFamily = urlParams.fontFamily ? `${urlParams.fontFamily}, sans-serif` : 'Inter, sans-serif';
        });

        // Update every second
        setInterval(updateDateTime, 1000);

        // Display once on page load
        updateDateTime();
    </script>
</body>
</html>
